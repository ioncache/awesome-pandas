<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="author" content="Awesome Pandas"/>
        <meta name="description" content="">
        <meta name="keywords" content="" />
        <meta name="robots" content="index, nofollow">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/bootstrap-responsive.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/bootmetro.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/bootmetro-tiles.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/bootmetro-charms.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/metro-ui-light.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/icomoon.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/datepicker.css">
        <link rel="stylesheet" type="text/css" href="css/vendor/bootmetro/css/daterangepicker.css">
        <link rel="stylesheet" href="css/main.css">

        <link rel="shortcut icon" href="css/vendor/bootmetro/ico/favicon.ico">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="css/vendor/bootmetro/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="css/vendor/bootmetro/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="css/vendor/bootmetro/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="css/vendor/bootmetro/ico/apple-touch-icon-57-precomposed.png">

<script>
var _ratchetParams = {"server.environment": "production"};
var _ratchet=["d3ac21376b0e414d9e4b66ce17a429f4", _ratchetParams];
(function(w,d){w.onerror=function(){_ratchet.push(arguments);};var i=function(){var s=d.createElement("script");var 
f=d.getElementsByTagName("script")[0];s.src="//d2tf6sbdgil6xr.cloudfront.net/js/11/ratchet.js";s.async=!0;
f.parentNode.insertBefore(s,f);};if(w.addEventListener){w.addEventListener("load",i,!1);}else{w.attachEvent("onload",i);}})(window,document);
</script>

        <script src="/socket.io/socket.io.js"></script>
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="brand" href="#/"><span class="title_text">Chart Chat</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li id="home_page" class="menu_item active"><a href="#/">Charts</a></li>
                            <li id="profile_page" class="menu_item"><a href="#/leaderboard/1">Profile</a></li>
                        </ul>
                    </div>
                    <div id="user_info" class="pull-right" style="display: none; height: 41px; line-height: 41px; color: #9EBA91; cursor: pointer;">
                        Logged in as: <span data-bind="text: username"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="wrapper">
            <div class="container">
                <div id="chart" class="view" style="display: block; position: relative;">
                    <div id="chart_info" class="well" style="position: relative;">
                        Test1
                    </div>
                    <div id="chart_container" class="span12"></div>
                    <div id="chat_container" class="span14"></div>
                </div>
            </div>
        </div>
        

        <!-- all javascript except for modernizr -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.2.min.js"><\/script>')</script>

        <script src="js/vendor/sammy-latest.min.js"></script>
        <script src="js/vendor/highcharts/highcharts.js"></script>
        <script src="js/vendor/highstock/highstock.js"></script>

        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <script>
        var room = 'USD_CAD';
        var socket = io.connect(location.origin);
        var session_id;
        var series_data = [];
        $(document).ready(function() {
    
            // on connection to server, ask for user's name with an anonymous callback
            socket.on('connect', function(){
                // call the server-side function 'adduser' and send one parameter (value of prompt)
                socket.emit('adduser', room, prompt("What's your name?"));
            });
        
            socket.on('snapshot', function(data) {
                console.log(data);
                $.each(data.candles.H1, function(i, e) {
                    series_data.push([e.time*1000, e['open mid'], e['high mid'], e['low mid'], e['close mid']]);
                });
                console.log(series_data);
                // create the chart
                chart = new Highcharts.StockChart({
                   chart : {
                       renderTo : 'chart_container'/*,
                        events: {
                            load: function() {
                
                                // set up the updating of the chart each second
                                var series = this.series[0];
                                setInterval(function() {
                                    var x = (new Date()).getTime(), // current time
                                        y = Math.random();
                                    series.addPoint([x, y], true, true);
                                }, 1000);
                            }
                        }*/
                   },
                
                   rangeSelector : {
                       selected : 1
                   },
                
                   title : {
                       text : room.replace('_', '/')
                   },
                
                   series : [{
                       type : 'candlestick',
                       name : room.replace('_', '/'),
                       data : series_data,
                       dataGrouping : {
                           units : [
                               ['hour', // unit name
                               [1] // allowed multiples
                           ], [
                               'hour',
                               [1, 2, 3, 4, 6]]
                           ]
                       }
                   }]
                });
            });
        
            // listener, whenever the server emits 'updatechat', this updates the chat body
            socket.on('updatechat', function (username, data) {
                $('#chat_container').append('<b>'+username + ':</b> ' + data + '<br>');
            });
        
            // listener, whenever the server emits 'updateusers', this updates the username list
            socket.on('updateusers', function(data) {
                $('#users').empty();
                $.each(data, function(key, value) {
                    $('#users').append('<div>' + key + '</div>');
                });
            });
    
    
            // TODO: add router, Sammy or Backbone
            //router = Sammy(function() {
            //    // profile pages
            //    this.get(/\#\/profile\/(.*)/, function() {
            //        var display_name = this.params['splat'];
            //
            //        var profile_promise = get_profile(display_name);
            //
            //        profile_promise.done(function() {
            //            show_view('profile');
            //        });
            //    });
            //
            //    // leaderboard pages
            //    this.get(/\#\/charts\/(\d+)/, function() {
            //        var currency_pair = this.params['splat'];
            //        show_view('chart');
            //    });
            //
            //});
            //router.run(); 
            
        });

        </script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<!--        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>-->
    </body>
</html>
